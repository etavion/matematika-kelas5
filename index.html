<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kuis Matematika Kelas 5 â€” 60 Menit</title>
  <style>
    /* Mobile-friendly styling */
    :root{--bg:#0f172a;--card:#0b1220;--accent:#10b981;--danger:#ef4444;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{margin:0;background:linear-gradient(180deg,#071126 0%, #071a2a 100%);color:#e6eef8;-webkit-font-smoothing:antialiased}
    .app{max-width:760px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:18px;margin:0}
    .timer{margin-left:auto;background:var(--glass);padding:8px 12px;border-radius:12px;font-weight:600}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:14px;margin-top:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .question{padding:12px;border-radius:12px;background:transparent;margin-bottom:10px}
    .q-head{display:flex;align-items:center;gap:10px}
    .q-index{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;font-weight:700}
    .q-text{flex:1}
    .choices{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .choice{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center}
    .choice input{appearance:none;width:20px;height:20px;border-radius:6px;border:2px solid rgba(255,255,255,0.12);flex:none}
    .choice label{flex:1}
    .btns{display:flex;gap:8px;margin-top:12px}
    .btn{flex:1;padding:12px;border-radius:10px;border:0;font-weight:700}
    .btn.primary{background:var(--accent);color:#032;}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    /* result */
    .result{padding:12px;border-radius:12px;margin-top:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .score{font-size:28px;font-weight:900}
    .explanation{margin-top:8px;padding:10px;border-radius:10px;background:rgba(0,0,0,0.25)}
    .explanation .ok{color:#0f5132;background:rgba(16,185,129,0.08);padding:8px;border-radius:8px}
    .explanation .bad{color:#7f1d1d;background:rgba(239,68,68,0.06);padding:8px;border-radius:8px}

    /* fraction style (stacked) */
    .fraction{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;margin:0 6px}
    .fraction .num{border-bottom:2px solid rgba(255,255,255,0.2);padding:0 6px;font-weight:700}
    .fraction .den{padding:0 6px}

    /* confetti canvas */
    #confetti{position:fixed;left:0;top:0;pointer-events:none;width:100%;height:100%;z-index:9999}

    /* falling emoji */
    .fall-emoji{position:fixed;left:50%;top:-10vh;font-size:36px;animation:fall 6s linear infinite;z-index:9999}
    @keyframes fall{0%{transform:translateX(-50%) translateY(-10vh) rotate(0)}100%{transform:translateX(-50%) translateY(110vh) rotate(360deg)}}

    /* responsive tweaks */
    @media(min-width:700px){.app{padding:24px}.card{padding:18px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Kuis Matematika Kelas 5 â€” 60 menit</h1>
        <div style="font-size:12px;color:var(--muted)">45 soal pilihan ganda â€” simpan jawaban otomatis</div>
      </div>
      <div class="timer" id="timer">60:00</div>
    </header>

    <div class="card" id="quiz"></div>

    <div class="btns">
      <button class="btn ghost" id="reset">Reset Kuis</button>
      <button class="btn primary" id="finish">Selesai & Nilai</button>
    </div>

    <div id="resultArea"></div>
  </div>

  <canvas id="confetti"></canvas>

  <script>
    // --- DATA: 45 soal, opsi, jawaban, dan pembahasan ---
    const QUESTIONS = [
      {q: 'Nilai angka 6 pada bilangan 46.352 adalah â€¦', choices:['6','60','6.000','60.000'], a:2, explain:'Angka 6 berada pada posisi ratusan = 6.000.'},
      {q: 'Nilai tempat angka 4 pada bilangan 84.721 adalah â€¦', choices:['ribuan','ratusan','puluhan ribu','satuan'], a:2, explain:'Angka 4 berada di tempat puluhan ribu â†’ nilai = 40.000.'},
      {q: 'Angka yang berada pada tempat ratusan dalam bilangan 75.384 adalah â€¦', choices:['7','8','3','4'], a:2, explain:'Tempat ratusan adalah angka 3 (300).'},
      {q: 'Bilangan yang nilai puluhan ribunya adalah 3 adalah â€¦', choices:['34.250','43.250','23.450','32.540'], a:3, explain:'Pada 32.540 puluhan ribu=3 â†’ cocok.'},
      {q: 'Bentuk panjang dari 54.203 adalah â€¦', choices:['50.000 + 4.000 + 200 + 3','50.000 + 400 + 2 + 3','5.000 + 4.000 + 200 + 3','50.000 + 4.000 + 20 + 3'], a:3, explain:'54.203 = 50.000 + 4.000 + 200 + 3.'},

      {q: 'Manakah yang lebih besar? 45.600 â—‹ 45.060', choices:['>','<','='], a:0, explain:'45.600 lebih besar dari 45.060.'},
      {q: 'Urutkan dari yang terbesar: 23.450, 23.540, 23.405', choices:['23.540 â€“ 23.450 â€“ 23.405','23.405 â€“ 23.540 â€“ 23.450','23.450 â€“ 23.540 â€“ 23.405','23.540 â€“ 23.405 â€“ 23.450'], a:0, explain:'23.540 terbesar, lalu 23.450, lalu 23.405.'},
      {q: '78.200 â—‹ 78.299', choices:['>','<','='], a:1, explain:'78.200 lebih kecil dari 78.299.'},
      {q: 'Urutkan dari terkecil: 9.800, 8.900, 9.080, 8.990', choices:['8.900 â€“ 8.990 â€“ 9.080 â€“ 9.800','8.990 â€“ 8.900 â€“ 9.080 â€“ 9.800','8.900 â€“ 9.080 â€“ 8.990 â€“ 9.800','9.080 â€“ 8.900 â€“ 8.990 â€“ 9.800'], a:0, explain:'Urutan menaik: 8.900, 8.990, 9.080, 9.800.'},
      {q: 'Bilangan terkecil adalah â€¦ (15.320, 15.230, 15.302, 15.203)', choices:['15.320','15.230','15.302','15.203'], a:3, explain:'15.203 adalah yang paling kecil.'},

      {q: 'Dekomposisi dari 72.405 adalah â€¦', choices:['70.000 + 2.400 + 5','70.000 + 2.000 + 400 + 5','70.000 + 2.000 + 40 + 5','7.000 + 2.000 + 40 + 5'], a:2, explain:'72.405 = 70.000 + 2.000 + 40 + 5.'},
      {q: 'Komposisi dari 3 puluhan ribu + 6 ribuan + 4 ratus + 2 puluh + 7 adalah â€¦', choices:['36.427','34.627','30.647','36.247'], a:0, explain:'Jumlahkan nilai tempat â†’ 36.427.'},
      {q: 'Manakah yang merupakan dekomposisi 58.320?', choices:['50.000 + 8.000 + 300 + 20','5.000 + 8.000 + 300 + 20','50.000 + 800 + 30 + 2','50.000 + 8.000 + 32'], a:0, explain:'58.320 = 50.000 + 8.000 + 300 + 20.'},
      {q: 'Komposisi dari 4 ribuan + 2 ratus + 5 satuan adalah â€¦', choices:['4.205','4.250','4.025','4.502'], a:0, explain:'4.000 + 200 + 5 = 4.205.'},
      {q: 'Dekomposisi dari 90.304 adalah â€¦', choices:['90.000 + 3.000 + 4','90.000 + 300 + 4','9.000 + 30 + 4','90.000 + 30 + 4'], a:1, explain:'90.304 = 90.000 + 300 + 4.'},

      {q: '24.350 + 13.200 =', choices:['36.550','37.550','38.550','35.550'], a:1, explain:'24.350 + 13.200 = 37.550.'},
      {q: '56.800 â€“ 24.675 =', choices:['32.225','32.125','33.225','31.225'], a:0, explain:'56.800 âˆ’ 24.675 = 32.125? (cek). Perhitungan: 56800-24675=32125. Jadi jawaban harus 32.125. Namun untuk konsistensi soal asli pilih A/B? Untuk akurat, jawaban benar adalah 32.125.' , a:1},
      {q: '245 Ã— 36 =', choices:['8.520','8.820','8.220','9.120'], a:1, explain:'245Ã—36 = 245Ã—(30+6)=7350+1470=8820.'},
      {q: '3.600 Ã· 24 =', choices:['120','140','150','160'], a:2, explain:'3600Ã·24=150.'},
      {q: '12.480 + 4.520 â€“ 2.300 =', choices:['14.400','15.000','16.200','14.700'], a:3, explain:'12480+4520=17000; 17000âˆ’2300=14700.'},

      {q: 'Toko memiliki 12.545 kertas. Terjual 3.200. Sisa kertas =', choices:['9.445','9.355','9.345','9.455'], a:0, explain:'12545âˆ’3200=9345? Wait compute: 12545-3200=9345 â†’ choice C. Correcting to index 2.' , a:2},
      {q: '4 Ã— 3.750 =', choices:['15.000','14.500','12.500','13.500'], a:0, explain:'4Ã—3750=15000.'},
      {q: '98.000 Ã· 50 =', choices:['1.600','1.960','2.080','1.780'], a:1, explain:'98000Ã·50=1960.'},
      {q: '18.600 Ã· 12 =', choices:['1.450','1.550','1.600','2.050'], a:2, explain:'18600Ã·12=1550? Actually 12Ã—1550=18600 so correct is 1550 â†’ index 1.' , a:1},
      {q: '250 Ã— 125 =', choices:['31.250','30.250','32.500','25.125'], a:0, explain:'250Ã—125=31250.'},

      {q: 'KPK dari 6 dan 8 adalah â€¦', choices:['24','36','12','48'], a:0, explain:'Kelipatan persekutuan terkecil = 24.'},
      {q: 'FPB dari 24 dan 40 adalah â€¦', choices:['8','6','10','4'], a:0, explain:'Faktor persekutuan terbesar = 8.'},
      {q: 'KPK dari 12 dan 15 adalah â€¦', choices:['45','60','30','75'], a:1, explain:'KPK = 60.'},
      {q: 'FPB dari 30 dan 45 adalah â€¦', choices:['5','10','15','20'], a:2, explain:'FPB = 15.'},
      {q: 'KPK dari 9 dan 12 adalah â€¦', choices:['18','36','27','24'], a:1, explain:'KPK = 36.'},

      {q: 'Yang terbesar adalah â€¦', choices:['1/4','2/8','3/12','1/2'], a:3, explain:'1/2 = 0.5 paling besar.'},
      {q: 'Urutkan dari terkecil: 2/3, 1/2, 3/4', choices:['1/2 â€“ 2/3 â€“ 3/4','1/2 â€“ 3/4 â€“ 2/3','2/3 â€“ 1/2 â€“ 3/4','1/2 â€“ 3/4 â€“ 2/3'], a:0, explain:'1/2(0.5),2/3(0.666),3/4(0.75).'},
      {q: '5/6 â—‹ 4/6', choices:['>','<','='], a:0, explain:'5/6>4/6.'},
      {q: '3/5 â—‹ 2/3', choices:['>','<','='], a:1, explain:'3/5=0.6 < 2/3â‰ˆ0.666.'},
      {q: 'Yang terkecil adalah â€¦', choices:['4/10','2/5','1/2','3/10'], a:3, explain:'3/10 = 0.3 paling kecil.'},

      {q: '1/4 + 2/4 =', choices:['3/4','1/2','1','2/4'], a:0, explain:'1/4+2/4=3/4.'},
      {q: '3/5 â€“ 1/5 =', choices:['2/5','4/5','1/5','3/5'], a:0, explain:'3/5âˆ’1/5=2/5.'},
      {q: '2/3 + 1/6 =', choices:['5/6','4/6','3/4','2/6'], a:0, explain:'2/3=4/6 â†’ 4/6+1/6=5/6.'},
      {q: '7/8 â€“ 3/8 =', choices:['3/8','4/8','1/2','1/8'], a:1, explain:'7/8âˆ’3/8=4/8=1/2.'},
      {q: '1/2 + 1/3 =', choices:['5/6','2/5','3/5','4/6'], a:0, explain:'1/2+1/3=3/6+2/6=5/6.'},

      {q: 'Keliling persegi dengan sisi 12 cm adalah â€¦', choices:['48 cm','36 cm','24 cm','60 cm'], a:0, explain:'4Ã—12=48 cm.'},
      {q: 'Keliling persegi panjang 10 cm Ã— 6 cm adalah â€¦', choices:['26 cm','32 cm','40 cm','20 cm'], a:1, explain:'2Ã—(10+6)=32 cm.'},
      {q: 'Keliling segitiga dengan sisi 8 cm, 7 cm, dan 9 cm adalah â€¦', choices:['22 cm','24 cm','25 cm','26 cm'], a:2, explain:'8+7+9=24? Wait compute: 8+7+9=24 â†’ choice B. But original had C 25. Correct is 24.' , a:1},
      {q: 'Luas persegi panjang 12 cm Ã— 8 cm adalah â€¦', choices:['80 cmÂ²','96 cmÂ²','90 cmÂ²','72 cmÂ²'], a:1, explain:'12Ã—8=96 cmÂ².'},
      {q: 'Luas segitiga dengan alas 10 cm dan tinggi 6 cm adalah â€¦', choices:['30 cmÂ²','32 cmÂ²','28 cmÂ²','34 cmÂ²'], a:0, explain:'(1/2)Ã—10Ã—6=30 cmÂ².'}
    ];

    // Note: Several corrections were made inline for accurate numeric answers.

    const STORAGE_KEY = 'kuis_kelas5_state_v1';

    // --- state handling ---
    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) return JSON.parse(raw);
      const end = Date.now()+60*60*1000; // 60 minutes from now
      const answers = Array(QUESTIONS.length).fill(null);
      return {endTime:end, answers, finished:false, score:null};
    }
    function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }

    let state = loadState();

    // If no endTime present (fresh), but user requested timer 60, keep as is.
    if(!state.endTime) { state.endTime = Date.now()+60*60*1000; saveState(state); }

    const quizEl = document.getElementById('quiz');
    const timerEl = document.getElementById('timer');
    const resultArea = document.getElementById('resultArea');

    function renderQuiz(){
      quizEl.innerHTML = '';
      QUESTIONS.forEach((item, idx)=>{
        const q = document.createElement('div'); q.className='question';
        q.innerHTML = `
          <div class="q-head">
            <div class="q-index">${idx+1}</div>
            <div class="q-text">${item.q}</div>
          </div>
          <div class="choices" id="choices-${idx}"></div>
        `;
        quizEl.appendChild(q);
        const choicesEl = document.getElementById(`choices-${idx}`);
        item.choices.forEach((c, ci)=>{
          // convert fraction textual like '1/2' into stacked fraction if present
          let labelHTML = escapeHtml(c).replace(/(\d+)\/(\d+)/g, (m,p1,p2)=>{
            return `<span class="fraction"><span class="num">${p1}</span><span class="den">${p2}</span></span>`;
          });
          const id = `q${idx}_c${ci}`;
          const checked = state.answers[idx]===ci ? 'checked' : '';
          const disabled = state.finished ? 'disabled' : '';
          const choice = document.createElement('div'); choice.className='choice';
          choice.innerHTML = `<input type="radio" name="q${idx}" id="${id}" data-q="${idx}" data-c="${ci}" ${checked} ${disabled} /> <label for="${id}">${labelHTML}</label>`;
          choicesEl.appendChild(choice);
        });
      });
    }

    function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    renderQuiz();

    // attach listeners to choices
    quizEl.addEventListener('change', (e)=>{
      if(e.target && e.target.dataset && e.target.dataset.q){
        const q = Number(e.target.dataset.q); const c = Number(e.target.dataset.c);
        state.answers[q] = c; saveState(state);
      }
    });

    // Timer loop
    let timerInterval = setInterval(()=>{
      const now = Date.now(); const remain = state.endTime - now;
      if(remain<=0){ timerEl.textContent = '00:00'; clearInterval(timerInterval); if(!state.finished) autoSubmit(); return; }
      const mm = Math.floor(remain/60000); const ss = Math.floor((remain%60000)/1000);
      timerEl.textContent = `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    }, 250);

    // Auto-submit when time runs out
    function autoSubmit(){ if(!state.finished){ gradeAndShow(); } }

    // Finish button
    document.getElementById('finish').addEventListener('click', ()=>{ if(confirm('Kamu yakin ingin selesai dan melihat nilai?')) gradeAndShow(); });

    // Reset
    document.getElementById('reset').addEventListener('click', ()=>{
      if(!confirm('Reset akan menghapus jawaban & mulai timer baru. Lanjutkan?')) return;
      state = {endTime:Date.now()+60*60*1000, answers:Array(QUESTIONS.length).fill(null), finished:false, score:null}; saveState(state); location.reload();
    });

    function gradeAndShow(){
      // compute correct
      let correct=0; const details = [];
      QUESTIONS.forEach((it,i)=>{
        const user = state.answers[i]; const ok = user===it.a; if(ok) correct++; details.push({user,ok});
      });
      // score 1-100 (if 0 -> 1)
      let pct = Math.round((correct/QUESTIONS.length)*100);
      if(pct<1) pct=1;
      state.finished=true; state.score=pct; saveState(state);

      // disable inputs
      document.querySelectorAll('input[type=radio]').forEach(x=>x.disabled=true);

      // show result card
      resultArea.innerHTML = '';
      const r = document.createElement('div'); r.className='result';
      r.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between"><div><div style="font-size:14px;color:var(--muted)">Nilai kamu</div><div class="score">${pct}</div></div><div style="text-align:right"><div style="font-size:12px;color:var(--muted)">Benar ${correct} dari ${QUESTIONS.length}</div></div></div>`;

      // detailed explanations
      const exWrap = document.createElement('div'); exWrap.style.marginTop='12px';
      QUESTIONS.forEach((it,i)=>{
        const d = details[i];
        const ex = document.createElement('div'); ex.className='explanation';
        if(d.ok){ ex.innerHTML = `<div class="ok">Soal ${i+1} â€” Jawaban benar. ${it.explain}</div>`; }
        else{
          const userLabel = d.user===null ? 'Tidak menjawab' : it.choices[d.user];
          ex.innerHTML = `<div class="bad">Soal ${i+1} â€” Jawaban salah. Jawaban kamu: ${escapeHtml(String(userLabel))}. Jawaban benar: ${formatChoice(it.choices[it.a])}.<div style="margin-top:6px;color:var(--muted);font-size:13px">Penjelasan: ${it.explain}</div></div>`;
        }
        exWrap.appendChild(ex);
      });

      r.appendChild(exWrap);
      resultArea.appendChild(r);

      // show confetti or crying emojis
      if(pct>75){ startConfetti(); } else { startCrying(); }
    }

    function formatChoice(c){ return escapeHtml(c).replace(/(\d+)\/(\d+)/g, (m,p1,p2)=>`<span class="fraction"><span class="num">${p1}</span><span class="den">${p2}</span></span>`); }

    // If previously finished, show results on load
    if(state.finished && state.score!=null){ setTimeout(gradeAndShow, 250); }

    // --- confetti ---
    const confettiCanvas = document.getElementById('confetti'); const ctx = confettiCanvas.getContext('2d');
    function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    let confettiParticles = [];
    function startConfetti(){
      // create many particles
      confettiParticles = [];
      const colors = ['#F87171','#FB923C','#FACC15','#34D399','#60A5FA','#A78BFA'];
      for(let i=0;i<200;i++){
        confettiParticles.push({x:Math.random()*confettiCanvas.width, y:Math.random()*-confettiCanvas.height, vx:(Math.random()-0.5)*2, vy:2+Math.random()*4, size:4+Math.random()*8, color:colors[Math.floor(Math.random()*colors.length)], rot:Math.random()*360, vr: (Math.random()-0.5)*6});
      }
      confettiLoop();
      setTimeout(()=>{ confettiParticles = []; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }, 12000);
    }
    function confettiLoop(){ ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); confettiParticles.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6); ctx.restore(); }); if(confettiParticles.length) requestAnimationFrame(confettiLoop);
    }

    // crying emoji fall
    function startCrying(){
      // create many emoji elements falling
      for(let i=0;i<40;i++){
        const el = document.createElement('div'); el.className='fall-emoji'; el.style.left = Math.random()*100 + '%'; el.style.fontSize = (24+Math.random()*40)+'px'; el.style.animationDuration = (4+Math.random()*6)+'s'; el.textContent = 'ðŸ˜­'; document.body.appendChild(el);
        setTimeout(()=>el.remove(), 10000);
      }
    }

  </script>
</body>
</html>
